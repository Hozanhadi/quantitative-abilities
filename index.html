<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>منصة اختبارات القدرات الكمي</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .app-wrapper {
            height: 100%;
            width: 100%;
            overflow-y: auto;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 0;
                transform: translateY(0);
            }
        }
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-right: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .option-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: right;
        }
        .option-btn:hover {
            background: #e8e8ff;
            border-color: #667eea;
        }
        .option-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .topic-btn {
            display: block;
            width: 100%;
            padding: 16px;
            margin: 10px 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: right;
            font-weight: 500;
            color: #333;
        }
        .topic-btn:hover {
            background: #f9f9ff;
            border-color: #667eea;
            transform: translateX(-5px);
        }
        .test-num-btn {
            padding: 10px 16px;
            margin: 5px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .test-num-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .test-num-btn.completed {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        .results-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .results-table table {
            width: 100%;
            border-collapse: collapse;
        }
        .results-table th, .results-table td {
            padding: 14px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }
        .results-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        .results-table tr:hover {
            background: #f9f9ff;
        }
    </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div class="app-wrapper">
   <!-- Login Screen -->
   <div id="loginScreen" class="min-h-full flex items-center justify-center p-4 fade-in">
    <div class="bg-white rounded-16 shadow-2xl p-8 w-full max-w-md">
     <h1 id="appTitle" class="text-3xl font-bold text-center mb-2" style="color: #667eea;">منصة اختبارات القدرات</h1>
     <p class="text-center text-gray-600 mb-8">القسم الكمي</p>
     <div class="mb-6">
      <label class="block text-right mb-2 font-semibold text-gray-700">اسم الطالب:</label> <input type="text" id="studentName" placeholder="أدخل اسمك" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-600 text-right">
      <div id="nameError" class="text-red-500 text-sm mt-2" style="display:none;">
       الرجاء إدخال الاسم
      </div>
     </div>
     <div class="mb-6">
      <label class="block text-right mb-2 font-semibold text-gray-700">كلمة المرور:</label> <input type="password" id="passwordInput" placeholder="أدخل كلمة المرور" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-600 text-right">
      <div id="passError" class="text-red-500 text-sm mt-2" style="display:none;">
       كلمة المرور غير صحيحة
      </div>
     </div><button id="loginBtn" class="w-full py-3 bg-gradient-to-r from-purple-600 to-purple-800 text-white font-bold rounded-lg hover:from-purple-700 hover:to-purple-900 transition mb-4"> دخول </button> <button id="adminLoginBtn" class="w-full py-3 bg-gray-500 text-white font-bold rounded-lg hover:bg-gray-600 transition"> دخول المدير </button>
    </div>
   </div><!-- Student Dashboard -->
   <div id="studentDashboard" style="display:none;" class="fade-in">
    <div class="bg-white shadow-lg">
     <div class="max-w-6xl mx-auto px-6 py-6 flex justify-between items-center">
      <button id="logoutBtn" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">تسجيل الخروج</button>
      <div class="text-center">
       <h2 class="text-2xl font-bold" style="color: #667eea;">أهلاً <span id="studentNameDisplay"></span></h2>
      </div>
     </div>
    </div>
    <div class="max-w-6xl mx-auto px-6 py-8">
     <!-- Topics List -->
     <div id="topicsView" style="display:block;">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
       <div class="bg-white rounded-lg shadow-lg p-6">
        <h3 class="text-xl font-bold mb-4" style="color: #667eea;">اختر الموضوع</h3>
        <div id="topicsList"></div>
       </div>
       <div class="bg-white rounded-lg shadow-lg p-6">
        <h3 class="text-xl font-bold mb-4" style="color: #667eea;">إحصائياتك</h3>
        <div id="statsContainer" class="space-y-4">
         <div>
          <p class="text-gray-600">الاختبارات المكتملة:</p>
          <p class="text-3xl font-bold" style="color: #667eea;"><span id="completedCount">0</span>/275</p>
         </div>
         <div>
          <p class="text-gray-600">متوسط النتيجة:</p>
          <p class="text-3xl font-bold" style="color: #764ba2;"><span id="averageScore">0</span>%</p>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Explanation View -->
     <div id="explanationView" style="display:none;"><button id="backFromExplanation" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 mb-6">العودة</button>
      <div class="bg-white rounded-lg shadow-lg p-8">
       <h2 id="explanationTitle" class="text-3xl font-bold mb-6" style="color: #667eea;"></h2>
       <div id="explanationContent" class="space-y-6 text-lg leading-relaxed"></div><button id="startTestBtn" class="w-full py-3 bg-gradient-to-r from-green-500 to-green-700 text-white font-bold rounded-lg hover:from-green-600 hover:to-green-800 mt-8">ابدأ الاختبارات</button>
      </div>
     </div><!-- Tests List -->
     <div id="testsView" style="display:none;">
      <button id="backToTopics" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 mb-6">العودة</button>
      <div class="bg-white rounded-lg shadow-lg p-6">
       <h3 id="testsTitle" class="text-2xl font-bold mb-6" style="color: #667eea;"></h3>
       <div id="testsList" class="flex flex-wrap justify-start gap-2"></div>
      </div>
     </div><!-- Test Execution -->
     <div id="testView" style="display:none;">
      <div class="bg-white rounded-lg shadow-lg p-6">
       <div class="flex justify-between items-center mb-6">
        <button id="backToTests" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">العودة</button>
        <h3 id="testTitle" class="text-2xl font-bold" style="color: #667eea;"></h3>
       </div>
       <div id="testContent"></div><button id="submitTestBtn" class="w-full py-3 bg-gradient-to-r from-green-500 to-green-700 text-white font-bold rounded-lg hover:from-green-600 hover:to-green-800 mt-8" style="display:none;">إرسال الإجابات</button>
      </div>
     </div><!-- Test Results -->
     <div id="resultsView" style="display:none;">
      <div class="bg-white rounded-lg shadow-lg p-6">
       <div class="flex justify-between items-center mb-6">
        <button id="backToDash" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">العودة للرئيسية</button>
        <h3 class="text-2xl font-bold" style="color: #667eea;">نتائج الاختبار</h3>
       </div>
       <div class="bg-gradient-to-r from-green-100 to-blue-100 rounded-lg p-8 text-center mb-8">
        <p class="text-gray-700 mb-2">نتيجتك:</p>
        <p id="finalScore" class="text-5xl font-bold" style="color: #667eea;"></p>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Admin Dashboard -->
   <div id="adminDashboard" style="display:none;" class="fade-in">
    <div class="bg-white shadow-lg">
     <div class="max-w-6xl mx-auto px-6 py-6 flex justify-between items-center">
      <button id="adminLogoutBtn" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">تسجيل الخروج</button>
      <h2 class="text-2xl font-bold" style="color: #667eea;">لوحة المدير</h2>
     </div>
    </div>
    <div class="max-w-6xl mx-auto px-6 py-8">
     <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h3 class="text-2xl font-bold mb-6" style="color: #667eea;">نتائج الطلاب</h3>
      <div class="results-table">
       <table id="resultsTable">
        <thead>
         <tr>
          <th>اسم الطالب</th>
          <th>الموضوع</th>
          <th>رقم الاختبار</th>
          <th>النتيجة</th>
          <th>التاريخ والوقت</th>
         </tr>
        </thead>
        <tbody id="resultsBody">
        </tbody>
       </table>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
        const PASSWORD = "2010";
        const TOPICS = [
            { id: 'arithmetic', name: 'الحسابيات' },
            { id: 'algebra', name: 'الجبر' },
            { id: 'geometry', name: 'الهندسة' },
            { id: 'statistics', name: 'الإحصاء والاحتمالات' },
            { id: 'comparisons', name: 'المقارنات الكمية' }
        ];

        let currentStudent = null;
        let currentTopic = null;
        let currentTest = null;
        let allRecords = [];
        let currentAnswers = {};

        // Load student results from localStorage
        function loadFromLocalStorage() {
            const stored = localStorage.getItem('studentResults');
            return stored ? JSON.parse(stored) : [];
        }

        // Save student results to localStorage
        function saveToLocalStorage(records) {
            localStorage.setItem('studentResults', JSON.stringify(records));
        }

        // Initialize with stored data
        function initializeApp() {
            allRecords = loadFromLocalStorage();
            updateAdminTable();
        }

        // Test Database - 55 tests per topic
        const testDatabase = {
            comprehension: generateTests('comprehension', 55),
            completion: generateTests('completion', 55),
            analogy: generateTests('analogy', 55),
            error: generateTests('error', 55),
            odd: generateTests('odd', 55)
        };

        function generateTests(topic, count) {
            const tests = [];
            const testData = {
                arithmetic: [
                    { q: "إذا كان 15 ÷ 3 = ؟", options: ["أ) 3", "ب) 4", "ج) 5", "د) 6"], answer: 2 },
                    { q: "ما ناتج 7 × 8 - 5 = ؟", options: ["أ) 51", "ب) 52", "ج) 53", "د) 54"], answer: 0 },
                    { q: "إذا كان 20% من 50 = ؟", options: ["أ) 5", "ب) 10", "ج) 15", "د) 20"], answer: 1 },
                    { q: "ما الرقم الناقص: 2، 4، 6، 8، ؟", options: ["أ) 9", "ب) 10", "ج) 11", "د) 12"], answer: 1 },
                    { q: "إذا كان √16 = ؟", options: ["أ) 2", "ب) 3", "ج) 4", "د) 5"], answer: 2 },
                    { q: "ما ناتج 100 - 25 + 10 = ؟", options: ["أ) 75", "ب) 80", "ج) 85", "د) 90"], answer: 2 },
                    { q: "إذا كان 3² = ؟", options: ["أ) 6", "ب) 8", "ج) 9", "د) 12"], answer: 2 },
                    { q: "ما ناتج 12 ÷ 4 × 2 = ؟", options: ["أ) 3", "ب) 4", "ج) 5", "د) 6"], answer: 3 },
                    { q: "إذا كان 50% من 200 = ؟", options: ["أ) 50", "ب) 75", "ج) 100", "د) 125"], answer: 2 },
                    { q: "ما الرقم الناقص: 1، 1، 2، 3، 5، ؟", options: ["أ) 6", "ب) 7", "ج) 8", "د) 9"], answer: 2 }
                ],
                algebra: [
                    { q: "إذا كان x + 5 = 12، فما قيمة x؟", options: ["أ) 5", "ب) 7", "ج) 9", "د) 11"], answer: 1 },
                    { q: "حل المعادلة: 2x - 3 = 7", options: ["أ) 3", "ب) 4", "ج) 5", "د) 6"], answer: 2 },
                    { q: "إذا كان 3x = 15، فما قيمة x؟", options: ["أ) 3", "ب) 4", "ج) 5", "د) 6"], answer: 2 },
                    { q: "حل: x² = 25", options: ["أ) 3", "ب) 4", "ج) 5", "د) 6"], answer: 2 },
                    { q: "إذا كان x - 4 = 2x - 10، فما قيمة x؟", options: ["أ) 3", "ب) 4", "ج) 5", "د) 6"], answer: 3 },
                    { q: "اختر التعبير المكافئ لـ (x + 2)²", options: ["أ) x² + 4", "ب) x² + 2x + 4", "ج) x² + 4x + 4", "د) x² + 4x + 2"], answer: 2 },
                    { q: "إذا كان 5x + 2 = 17، فما قيمة x؟", options: ["أ) 2", "ب) 3", "ج) 4", "د) 5"], answer: 2 },
                    { q: "حل: 4x - 1 = 11", options: ["أ) 2", "ب) 3", "ج) 4", "د) 5"], answer: 1 },
                    { q: "إذا كان 2x + 3y = 12 و x = 3، فما قيمة y؟", options: ["أ) 1", "ب) 2", "ج) 3", "د) 4"], answer: 1 },
                    { q: "حل: (x + 3) = 10 - x", options: ["أ) 2", "ب) 2.5", "ج) 3", "د) 3.5"], answer: 3 }
                ],
                geometry: [
                    { q: "ما مجموع زوايا المثلث؟", options: ["أ) 90°", "ب) 180°", "ج) 270°", "د) 360°"], answer: 1 },
                    { q: "إذا كان طول ضلع المربع 5 سم، ما مساحته؟", options: ["أ) 20", "ب) 25", "ج) 30", "د) 35"], answer: 1 },
                    { q: "ما محيط دائرة نصف قطرها 7 سم؟", options: ["أ) 14π", "ب) 49π", "ج) 7π", "د) 21π"], answer: 0 },
                    { q: "مساحة المثلث = ؟", options: ["أ) القاعدة × الارتفاع", "ب) القاعدة × الارتفاع ÷ 2", "ج) القاعدة + الارتفاع", "د) القاعدة ÷ الارتفاع"], answer: 1 },
                    { q: "إذا كان طول المستطيل 8 وعرضه 6، ما محيطه؟", options: ["أ) 14", "ب) 24", "ج) 28", "د) 48"], answer: 2 },
                    { q: "ما مساحة دائرة نصف قطرها 3 سم؟", options: ["أ) 3π", "ب) 6π", "ج) 9π", "د) 12π"], answer: 2 },
                    { q: "كم عدد أضلاع المسدس؟", options: ["أ) 4", "ب) 5", "ج) 6", "د) 8"], answer: 2 },
                    { q: "ما مجموع زوايا الشكل الرباعي؟", options: ["أ) 180°", "ب) 270°", "ج) 360°", "د) 450°"], answer: 2 },
                    { q: "إذا كانت قاعدة المثلث 10 وارتفاعه 6، ما مساحته؟", options: ["أ) 20", "ب) 30", "ج) 40", "د) 60"], answer: 1 },
                    { q: "ما طول قطر المربع الذي طول ضلعه 4 سم؟", options: ["أ) 4√2", "ب) 4", "ج) 8", "د) 4√3"], answer: 0 }
                ],
                statistics: [
                    { q: "ما المتوسط الحسابي للأرقام: 2، 4، 6، 8؟", options: ["أ) 4", "ب) 5", "ج) 6", "د) 7"], answer: 1 },
                    { q: "إذا رميت زهرة نرد، ما احتمالية ظهور رقم زوجي؟", options: ["أ) 1/2", "ب) 1/3", "ج) 1/4", "د) 1/6"], answer: 0 },
                    { q: "ما الوسيط للأرقام: 1، 3، 5، 7، 9؟", options: ["أ) 3", "ب) 5", "ج) 7", "د) 9"], answer: 1 },
                    { q: "إذا كان احتمالية نجاح حدث 0.7، ما احتمالية فشله؟", options: ["أ) 0.1", "ب) 0.2", "ج) 0.3", "د) 0.4"], answer: 2 },
                    { q: "ما المنوال للأرقام: 1، 2، 2، 3، 3، 3، 4؟", options: ["أ) 1", "ب) 2", "ج) 3", "د) 4"], answer: 2 },
                    { q: "ما احتمالية رسم ورقة حمراء من مجموعة 52 ورقة لعب؟", options: ["أ) 1/4", "ب) 1/2", "ج) 1/3", "د) 2/3"], answer: 1 },
                    { q: "إذا كان المتوسط 10 وعدد العناصر 5، فما المجموع؟", options: ["أ) 30", "ب) 40", "ج) 50", "د) 60"], answer: 2 },
                    { q: "ما المتوسط الحسابي للأرقام: 10، 20، 30؟", options: ["أ) 15", "ب) 20", "ج) 25", "د) 30"], answer: 1 },
                    { q: "إذا رميت قطعة نقود مرتين، كم عدد النتائج الممكنة؟", options: ["أ) 2", "ب) 3", "ج) 4", "د) 5"], answer: 2 },
                    { q: "ما الانحراف المعياري للأرقام: 1، 1، 1، 1؟", options: ["أ) 0", "ب) 1", "ج) 2", "د) √1"], answer: 0 }
                ],
                comparisons: [
                    { q: "قارن: 0.5 __ 1/2", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 2 },
                    { q: "إذا كان x = 5 و y = 10، قارن: x + y __ 2x + 5", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 2 },
                    { q: "قارن: 3/4 __ 0.75", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 2 },
                    { q: "إذا كان a = 2 و b = 3، قارن: a² + b² __ (a + b)²", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 1 },
                    { q: "قارن: -5 __ -3", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 1 },
                    { q: "إذا كان x > 0، قارن: x __ 1/x", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 3 },
                    { q: "قارن: 2^3 __ 3^2", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 1 },
                    { q: "إذا كان a < 0، قارن: a __ a²", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 1 },
                    { q: "قارن: √4 __ ∛8", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 2 },
                    { q: "قارن: 1/3 + 1/4 __ 7/12", options: ["أ) أكبر من", "ب) أصغر من", "ج) يساوي", "د) لا يمكن تحديد"], answer: 2 }
                ]
            };

            for (let i = 1; i <= count; i++) {
                const baseData = testData[topic] || testData.arithmetic;
                const questionIndex = (i - 1) % baseData.length;
                
                // Create 10 questions for each test
                const testQuestions = [];
                for (let q = 0; q < 10; q++) {
                    const idx = (questionIndex + q) % baseData.length;
                    testQuestions.push({
                        id: q,
                        ...baseData[idx]
                    });
                }
                
                tests.push({
                    number: i,
                    questions: testQuestions,
                    total: 10
                });
            }
            return tests;
        }

        // Login
        document.getElementById('loginBtn').addEventListener('click', () => {
            const name = document.getElementById('studentName').value.trim();
            const pass = document.getElementById('passwordInput').value;

            document.getElementById('nameError').style.display = 'none';
            document.getElementById('passError').style.display = 'none';

            if (!name) {
                document.getElementById('nameError').style.display = 'block';
                return;
            }
            if (pass !== PASSWORD) {
                document.getElementById('passError').style.display = 'block';
                return;
            }

            currentStudent = name;
            showStudentDashboard();
        });

        document.getElementById('adminLoginBtn').addEventListener('click', () => {
            const name = document.getElementById('studentName').value.trim();
            const pass = document.getElementById('passwordInput').value;

            document.getElementById('nameError').style.display = 'none';
            document.getElementById('passError').style.display = 'none';

            if (name !== 'هوزن') {
                document.getElementById('nameError').style.display = 'block';
                return;
            }
            if (pass !== PASSWORD) {
                document.getElementById('passError').style.display = 'block';
                return;
            }
            showAdminDashboard();
        });

        function showStudentDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('studentDashboard').style.display = 'block';
            document.getElementById('studentNameDisplay').textContent = currentStudent;
            renderTopics();
            updateStudentStats();
        }

        function showAdminDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            updateAdminTable();
        }

        function renderTopics() {
            const topicsList = document.getElementById('topicsList');
            topicsList.innerHTML = '';
            TOPICS.forEach(topic => {
                const btn = document.createElement('button');
                btn.className = 'topic-btn';
                btn.textContent = topic.name;
                btn.addEventListener('click', () => showExplanation(topic.id, topic.name));
                topicsList.appendChild(btn);
            });
        }

        function showTests(topicId, topicName) {
            currentTopic = topicId;
            document.getElementById('topicsView').style.display = 'none';
            document.getElementById('explanationView').style.display = 'none';
            document.getElementById('testsView').style.display = 'block';
            document.getElementById('testsTitle').textContent = topicName;

            const testsList = document.getElementById('testsList');
            testsList.innerHTML = '';

            const completedTests = allRecords.filter(r => r.student_name === currentStudent && r.topic === topicId).map(r => r.test_number);

            for (let i = 1; i <= 55; i++) {
                const btn = document.createElement('button');
                btn.className = 'test-num-btn';
                if (completedTests.includes(i)) {
                    btn.classList.add('completed');
                    btn.textContent = `✓ ${i}`;
                } else {
                    btn.textContent = i;
                }
                btn.addEventListener('click', () => showTest(i));
                testsList.appendChild(btn);
            }
        }

        function showTest(testNumber) {
            currentTest = testNumber;
            currentAnswers = {};
            const test = testDatabase[currentTopic][testNumber - 1];

            document.getElementById('testsView').style.display = 'none';
            document.getElementById('testView').style.display = 'block';
            document.getElementById('testTitle').textContent = `نموذج ${testNumber}`;

            const testContent = document.getElementById('testContent');
            testContent.innerHTML = '';

            // Display all 10 questions
            test.questions.forEach((question, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                
                const questionNum = document.createElement('p');
                questionNum.className = 'text-sm font-semibold mb-2' ;
                questionNum.style.color = '#667eea';
                questionNum.textContent = `السؤال ${qIndex + 1} من 10`;
                questionDiv.appendChild(questionNum);
                
                const questionText = document.createElement('h3');
                questionText.className = 'text-lg font-bold mb-4 text-right';
                questionText.textContent = question.q;
                questionDiv.appendChild(questionText);

                question.options.forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = option;
                    btn.addEventListener('click', () => {
                        // Remove selected from other options in THIS question only
                        questionDiv.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        currentAnswers[qIndex] = index;
                    });
                    questionDiv.appendChild(btn);
                });

                testContent.appendChild(questionDiv);
            });

            document.getElementById('submitTestBtn').style.display = 'block';
        }

        document.getElementById('submitTestBtn').addEventListener('click', async () => {
            if (Object.keys(currentAnswers).length < 10) {
                showNotification('الرجاء الإجابة على جميع الأسئلة (10 أسئلة)');
                return;
            }

            const test = testDatabase[currentTopic][currentTest - 1];
            let correctCount = 0;
            
            // Check answers
            test.questions.forEach((question, qIndex) => {
                if (currentAnswers[qIndex] === question.answer) {
                    correctCount++;
                }
            });

            const score = Math.round((correctCount / 10) * 100);

            document.getElementById('submitTestBtn').disabled = true;
            document.getElementById('submitTestBtn').textContent = 'جاري الحفظ...';

            // Save to localStorage instead of Data SDK
            const newRecord = {
                student_name: currentStudent,
                topic: currentTopic,
                test_number: currentTest,
                score: score,
                total_questions: 10,
                completed_at: new Date().toISOString()
            };
            
            allRecords.push(newRecord);
            saveToLocalStorage(allRecords);
            updateAdminTable();

            // Simulate delay for better UX
            setTimeout(() => {
                document.getElementById('testView').style.display = 'none';
                document.getElementById('resultsView').style.display = 'block';
                document.getElementById('finalScore').textContent = score + '% (' + correctCount + '/10)';
                
                document.getElementById('submitTestBtn').disabled = false;
                document.getElementById('submitTestBtn').textContent = 'إرسال الإجابات';
            }, 500);
        });

        document.getElementById('backToTests').addEventListener('click', () => {
            document.getElementById('testView').style.display = 'none';
            document.getElementById('testsView').style.display = 'block';
        });

        document.getElementById('backToTopics').addEventListener('click', () => {
            document.getElementById('testsView').style.display = 'none';
            document.getElementById('topicsView').style.display = 'block';
        });

        document.getElementById('backFromExplanation').addEventListener('click', () => {
            document.getElementById('explanationView').style.display = 'none';
            document.getElementById('topicsView').style.display = 'block';
        });

        document.getElementById('backToDash').addEventListener('click', () => {
            document.getElementById('resultsView').style.display = 'none';
            document.getElementById('topicsView').style.display = 'block';
        });

        document.getElementById('startTestBtn').addEventListener('click', () => {
            document.getElementById('explanationView').style.display = 'none';
            showTests(currentTopic, TOPICS.find(t => t.id === currentTopic).name);
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            currentStudent = null;
            document.getElementById('studentDashboard').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('studentName').value = '';
            document.getElementById('passwordInput').value = '';
        });

        document.getElementById('adminLogoutBtn').addEventListener('click', () => {
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('studentName').value = '';
            document.getElementById('passwordInput').value = '';
        });

        function updateStudentStats() {
            if (!currentStudent) return;

            const studentRecords = allRecords.filter(r => r.student_name === currentStudent);
            const completedCount = studentRecords.length;
            const totalScore = studentRecords.reduce((sum, r) => sum + r.score, 0);
            const averageScore = completedCount > 0 ? Math.round(totalScore / completedCount) : 0;

            document.getElementById('completedCount').textContent = completedCount;
            document.getElementById('averageScore').textContent = averageScore;
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff6b6b;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                z-index: 9999;
                font-weight: 600;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        const topicExplanations = {
            arithmetic: {
                title: 'الحسابيات',
                content: [
                    '<h3 class="text-2xl font-bold mb-3" style="color: #667eea;">تعريف الموضوع:</h3><p>الحسابيات تشمل العمليات الأساسية على الأرقام مثل الجمع والطرح والضرب والقسمة، بالإضافة إلى النسب المئوية والجذور والأسس.</p>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">المهارات المطلوبة:</h3><ul class="list-disc list-inside space-y-2"><li>إجراء العمليات الحسابية الأساسية بسرعة</li><li>فهم الأولويات في العمليات الحسابية</li><li>حساب النسب المئوية</li><li>التعامل مع الأسس والجذور</li><li>فهم المتتاليات والأنماط</li></ul>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">نصائح الحل:</h3><ul class="list-disc list-inside space-y-2"><li>تذكر ترتيب العمليات (الضرب والقسمة قبل الجمع والطرح)</li><li>احسب النسب المئوية بضرب الرقم في النسبة العشرية</li><li>استخدم الآلة الحاسبة للعمليات المعقدة</li><li>تحقق من إجابتك بالحساب العكسي</li></ul>'
                ]
            },
            algebra: {
                title: 'الجبر',
                content: [
                    '<h3 class="text-2xl font-bold mb-3" style="color: #667eea;">تعريف الموضوع:</h3><p>الجبر يتعامل مع حل المعادلات والتعبيرات الجبرية، ويتضمن المتغيرات والثوابت والعمليات بينها.</p>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">المهارات المطلوبة:</h3><ul class="list-disc list-inside space-y-2"><li>حل المعادلات الخطية والتربيعية</li><li>تحليل التعبيرات الجبرية</li><li>فهم خصائص المعادلات</li><li>التعامل مع الأس والجذور الجبرية</li><li>حل الأنظمة المتعددة من المعادلات</li></ul>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">نصائح الحل:</h3><ul class="list-disc list-inside space-y-2"><li>افصل المتغير عن طريق العمليات العكسية</li><li>تذكر أنك يجب أن تفعل نفس العملية على طرفي المعادلة</li><li>تحقق من الحل بتعويضه في المعادلة الأصلية</li><li>استخدم التحليل عند الضرورة</li></ul>'
                ]
            },
            geometry: {
                title: 'الهندسة',
                content: [
                    '<h3 class="text-2xl font-bold mb-3" style="color: #667eea;">تعريف الموضوع:</h3><p>الهندسة تتعامل مع الأشكال والمساحات والأطوال والزوايا والحجوم، وتشمل دراسة الخصائص المختلفة للأشكال الهندسية.</p>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">الصيغ الشائعة:</h3><ul class="list-disc list-inside space-y-2"><li><strong>المربع:</strong> المساحة = الضلع²، المحيط = 4 × الضلع</li><li><strong>المستطيل:</strong> المساحة = الطول × العرض، المحيط = 2(الطول + العرض)</li><li><strong>المثلث:</strong> المساحة = ½ × القاعدة × الارتفاع</li><li><strong>الدائرة:</strong> المساحة = πr²، المحيط = 2πr</li></ul>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">نصائح الحل:</h3><ul class="list-disc list-inside space-y-2"><li>حفظ الصيغ الأساسية ضروري جداً</li><li>رسم الشكل يساعد في فهم المسألة</li><li>تأكد من توحيد وحدات القياس</li><li>استخدم خصائص الأشكال المعروفة</li></ul>'
                ]
            },
            statistics: {
                title: 'الإحصاء والاحتمالات',
                content: [
                    '<h3 class="text-2xl font-bold mb-3" style="color: #667eea;">تعريف الموضوع:</h3><p>يتعامل هذا الموضوع مع تحليل البيانات والاحتمالات، ويشمل المتوسطات والاحتمالات والتوزيعات الإحصائية.</p>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">المقاييس الإحصائية:</h3><ul class="list-disc list-inside space-y-2"><li><strong>المتوسط:</strong> مجموع القيم ÷ عددها</li><li><strong>الوسيط:</strong> القيمة الوسطى عند ترتيب البيانات</li><li><strong>المنوال:</strong> القيمة الأكثر تكراراً</li><li><strong>الاحتمالية:</strong> عدد الحالات المواتية ÷ عدد الحالات الممكنة</li></ul>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">نصائح الحل:</h3><ul class="list-disc list-inside space-y-2"><li>رتب البيانات دائماً قبل إيجاد الوسيط</li><li>تذكر أن مجموع الاحتمالات = 1</li><li>ميز بين الأحداث المستقلة والمعتمدة</li><li>استخدم الشجرة الاحتمالية للحالات المعقدة</li></ul>'
                ]
            },
            comparisons: {
                title: 'المقارنات الكمية',
                content: [
                    '<h3 class="text-2xl font-bold mb-3" style="color: #667eea;">تعريف الموضوع:</h3><p>تتطلب المقارنات الكمية مقارنة كميتين أو أكثر وتحديد العلاقة بينهما (أكبر، أصغر، أو متساويان).</p>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">أنواع المقارنات:</h3><ul class="list-disc list-inside space-y-2"><li>مقارنة مباشرة بين رقمين أو عمليات</li><li>مقارنة باستخدام متغيرات</li><li>مقارنة عمليات معقدة</li><li>المقارنات الشرطية (إذا كان...)</li></ul>',
                    '<h3 class="text-2xl font-bold mb-3 mt-6" style="color: #667eea;">نصائح الحل:</h3><ul class="list-disc list-inside space-y-2"><li>احسب كل طرف بدقة أولاً</li><li>استخدم نفس وحدات القياس</li><li>تأكد من الشروط المعطاة (خاصة للمتغيرات)</li><li>إذا كنت في شك، حاول قيماً مختلفة للمتغيرات</li></ul>'
                ]
            }
        };

        function showExplanation(topicId, topicName) {
            currentTopic = topicId;
            const explanation = topicExplanations[topicId];
            
            document.getElementById('topicsView').style.display = 'none';
            document.getElementById('explanationView').style.display = 'block';
            document.getElementById('explanationTitle').textContent = explanation.title;
            
            const contentDiv = document.getElementById('explanationContent');
            contentDiv.innerHTML = explanation.content.join('');
        }

        function updateAdminTable() {
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            allRecords.forEach(record => {
                const row = document.createElement('tr');
                const date = new Date(record.completed_at).toLocaleString('ar-SA');
                const topicName = TOPICS.find(t => t.id === record.topic)?.name || record.topic;
                
                row.innerHTML = `
                    <td>${record.student_name}</td>
                    <td>${topicName}</td>
                    <td>${record.test_number}</td>
                    <td>${record.score}%</td>
                    <td>${date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize
        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d1ee83121487f15',t:'MTc3MTc2Nzc1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>